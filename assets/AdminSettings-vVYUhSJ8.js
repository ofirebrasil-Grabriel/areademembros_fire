import{s as i,j as e,B as c,k as R}from"./index-B66auDJq.js";import{r as a}from"./vendor-Cwg8D7Hp.js";import{$ as W,T as D,a as S,a0 as A,w as C,y as B,a1 as I,m as q,E as P}from"./ui-C5d7_9yU.js";import"./supabase-DfaSXaSt.js";const J=()=>{const[d,m]=a.useState(""),[x,h]=a.useState(""),[u,f]=a.useState(""),[g,p]=a.useState(""),[_,b]=a.useState(!1),[L,j]=a.useState(!0),[y,o]=a.useState(!1),[l,n]=a.useState(null),[N,z]=a.useState([]),[w,v]=a.useState(!1);a.useEffect(()=>{E()},[]);const E=async()=>{j(!0);try{const{data:s,error:r}=await i.from("app_config").select("key, value");if(r)throw r;if(s){const t={};s.forEach(k=>{t[k.key]=k.value}),m(t.n8n_welcome_url||""),h(t.n8n_recovery_url||""),f(t.hotmart_token||""),p(t.sales_page_url||"")}}catch{}finally{j(!1)}},T=async()=>{const s=[{key:"n8n_welcome_url",value:d},{key:"n8n_recovery_url",value:x},{key:"hotmart_token",value:u},{key:"sales_page_url",value:g}];try{const{error:r}=await i.from("app_config").upsert(s,{onConflict:"key"});if(r)throw r;b(!0),setTimeout(()=>b(!1),2e3)}catch(r){alert("Erro ao salvar configurações: "+r.message)}},U=async()=>{if(!window.confirm("ATENÇÃO: Isso irá inserir dados padrão no banco de dados. Certifique-se de que as tabelas estão vazias ou isso pode duplicar dados. Continuar?"))return;o(!0),n(null);const s=await R();o(!1),n(s),o(!1),n(s)},H=async()=>{v(!0);try{const{data:s,error:r}=await i.functions.invoke("admin-actions",{body:{action:"getWebhookLogs"}});if(r)throw r;z(s.logs||[])}catch(s){console.error("Error fetching logs:",s),alert("Erro ao buscar logs: "+s.message)}finally{v(!1)}};return L?e.jsx("div",{className:"p-8 text-white",children:"Carregando configurações..."}):e.jsxs("div",{className:"space-y-8 max-w-4xl pb-20",children:[e.jsx("h1",{className:"text-3xl font-bold text-white font-montserrat",children:"Configurações do Sistema"}),e.jsxs("section",{className:"bg-fire-secondary/20 border border-white/5 rounded-xl p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(W,{className:"text-fire-orange",size:24}),"Banco de Dados"]}),e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(D,{className:"text-yellow-500 shrink-0 mt-0.5",size:18}),e.jsxs("p",{className:"text-sm text-yellow-200",children:[e.jsx("strong",{children:"Inicialização de Conteúdo:"})," Se você acabou de criar as tabelas no Supabase, elas estarão vazias. Use o botão abaixo para preencher o banco de dados com os 15 dias do desafio, tarefas e exemplos de materiais."]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4",children:[e.jsx(c,{onClick:U,disabled:y,variant:"primary",children:y?e.jsxs("span",{className:"flex items-center",children:[e.jsx(S,{className:"animate-spin mr-2"})," Inicializando..."]}):"Inicializar Banco de Dados (Seed)"}),l&&e.jsx("span",{className:`text-sm font-medium ${l.success?"text-green-400":"text-red-400"}`,children:l.message})]})]}),e.jsxs("div",{className:"bg-fire-secondary/20 border border-white/5 rounded-2xl p-8",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-6 flex items-center gap-2",children:[e.jsx(A,{className:"text-fire-orange"}),"Integração Hotmart"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-fire-gray mb-2",children:"Token de Verificação (H-Hotmart-Hook-Token)"}),e.jsx("input",{type:"text",value:u,onChange:s=>f(s.target.value),className:"w-full bg-black/30 border border-white/10 rounded-lg px-4 py-3 text-white focus:border-fire-orange focus:outline-none",placeholder:"Token configurado no Webhook da Hotmart"}),e.jsx("p",{className:"text-xs text-fire-gray mt-2",children:"Use este token para verificar se as requisições vêm realmente da Hotmart."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-fire-gray mb-2",children:"URL da Página de Vendas (Checkout)"}),e.jsx("input",{type:"text",value:g,onChange:s=>p(s.target.value),className:"w-full bg-black/30 border border-white/10 rounded-lg px-4 py-3 text-white focus:border-fire-orange focus:outline-none",placeholder:"https://pay.hotmart.com/..."}),e.jsx("p",{className:"text-xs text-fire-gray mt-2",children:'Para onde os usuários serão redirecionados ao clicar em "Comprar Agora".'})]})]})]}),e.jsxs("div",{className:"bg-fire-secondary/20 border border-white/5 rounded-2xl p-8",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-6 flex items-center gap-2",children:[e.jsx(C,{className:"text-fire-orange"}),"Logs de Webhook (Debug)"]}),e.jsx("div",{className:"mb-4",children:e.jsxs(c,{onClick:H,disabled:w,variant:"secondary",children:[w?e.jsx(S,{className:"animate-spin mr-2"}):e.jsx(C,{className:"mr-2",size:18}),"Carregar Últimos Logs"]})}),N.length>0?e.jsx("div",{className:"bg-black/50 rounded-lg p-4 overflow-x-auto max-h-96 border border-white/10",children:e.jsx("pre",{className:"text-xs text-green-400 font-mono whitespace-pre-wrap",children:JSON.stringify(N,null,2)})}):e.jsx("p",{className:"text-fire-gray text-sm",children:"Nenhum log encontrado ou ainda não carregado."})]}),e.jsxs("section",{className:"bg-fire-secondary/20 border border-white/5 rounded-xl p-6 opacity-50 pointer-events-none",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(B,{className:"text-fire-gray",size:24}),"Integração Hotmart (Desativada)"]}),e.jsx("p",{className:"text-fire-gray mb-4 text-sm",children:"A integração principal agora é via Stripe."})]}),e.jsxs("section",{className:"bg-fire-secondary/20 border border-white/5 rounded-xl p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(I,{className:"text-fire-orange",size:24}),"Automação de E-mail (n8n)"]}),e.jsx("p",{className:"text-fire-gray mb-6 text-sm",children:"Configure as URLs dos webhooks do seu n8n Self-hosted aqui para disparar e-mails transacionais."}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-fire-gray uppercase tracking-wider mb-2",children:"Webhook de Boas-vindas"}),e.jsx("input",{type:"url",value:d,onChange:s=>m(s.target.value),placeholder:"https://n8n.seudominio.com.br/webhook/welcome-email",className:"w-full bg-black/30 border border-white/10 rounded-lg px-4 py-3 text-white placeholder-white/20 focus:border-fire-orange outline-none transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-fire-gray uppercase tracking-wider mb-2",children:"Webhook de Recuperação de Senha"}),e.jsx("input",{type:"url",value:x,onChange:s=>h(s.target.value),placeholder:"https://n8n.seudominio.com.br/webhook/password-recovery",className:"w-full bg-black/30 border border-white/10 rounded-lg px-4 py-3 text-white placeholder-white/20 focus:border-fire-orange outline-none transition-colors"})]})]}),e.jsx("div",{className:"mt-8 flex justify-end",children:e.jsx(c,{onClick:T,className:"min-w-[150px]",children:_?e.jsxs("span",{className:"flex items-center",children:[e.jsx(q,{size:18,className:"mr-2"})," Salvo!"]}):e.jsxs("span",{className:"flex items-center",children:[e.jsx(P,{size:18,className:"mr-2"})," Salvar Configurações"]})})})]})]})};export{J as AdminSettings};
