import{o as G,j as e,B as b,U as o,p as i,q as K,r as X,v as O,w as W,x as H}from"./index-C0bb4mgP.js";import{r,u as J}from"./vendor-Cwg8D7Hp.js";import{a6 as Q,N as Y,a as p,g as T,m as I,a4 as Z,ag as L,ah as ee,K as B,ai as se,S as P,a9 as ae,I as te,i as re,X as le,P as ie,L as oe}from"./ui-C5d7_9yU.js";import"./supabase-DfaSXaSt.js";const xe=()=>{const[C,f]=r.useState([]),[N,z]=r.useState(!0),[h,q]=r.useState(""),[l,n]=r.useState(null),[d,v]=r.useState(1),[g,E]=r.useState(0),j=10;J();const[R,w]=r.useState(!1),[c,S]=r.useState(null),[a,m]=r.useState({name:"",email:"",phone:"",role:"member",password:""}),[U,A]=r.useState(!1);r.useEffect(()=>{const s=setTimeout(()=>{M()},500);return()=>clearTimeout(s)},[d,h]);const M=async()=>{z(!0);const{data:s,count:t}=await G(d,j,h);f(s),E(t),z(!1)},V=s=>{q(s.target.value),v(1)},k=async(s,t)=>{l||(n(s),await X(s,t),f(u=>u.map(x=>x.id===s?{...x,status:t}:x)),n(null))},_=async(s,t)=>{l||window.confirm(`Tem certeza que deseja alterar o nível de acesso deste usuário para ${t}?`)&&(n(s),await K(s,t),f(u=>u.map(x=>x.id===s?{...x,role:t}:x)),n(null),n(null))},$=async s=>{if(!l&&window.confirm("Tem certeza que deseja EXCLUIR este usuário permanentemente? Esta ação não pode ser desfeita.")){n(s);try{await O(s),f(t=>t.filter(u=>u.id!==s)),E(t=>t-1)}catch(t){console.error("Error deleting user:",t),alert("Erro ao excluir usuário. Verifique se a Edge Function 'admin-actions' está implantada.")}finally{n(null)}}},D=s=>{s?(S(s),m({name:s.full_name||"",email:s.email||"",phone:s.phone||"",role:s.role,password:""})):(S(null),m({name:"",email:"",phone:"",role:i.MEMBER,password:""})),w(!0)},F=async s=>{s.preventDefault(),A(!0);try{c?(await W({userId:c.id,name:a.name,email:a.email,phone:a.phone,role:a.role,password:a.password||void 0}),alert("Usuário atualizado com sucesso!")):(await H({name:a.name,email:a.email,phone:a.phone,role:a.role,password:a.password}),alert("Usuário criado com sucesso!")),w(!1),M()}catch(t){console.error("Error saving user:",t),alert(`Erro ao salvar usuário: ${t.message}`)}finally{A(!1)}},y=Math.ceil(g/j);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white font-montserrat",children:"Gerenciar Usuários"}),e.jsx("p",{className:"text-fire-gray text-sm mt-1",children:"Controle de acesso, status e permissões dos membros."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(b,{onClick:()=>D(),className:"flex items-center gap-2",children:[e.jsx(Q,{size:18})," Novo Usuário"]}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-fire-gray",size:18}),e.jsx("input",{type:"text",placeholder:"Buscar por nome ou e-mail...",value:h,onChange:V,className:"pl-10 pr-4 py-2 bg-fire-secondary/30 border border-white/10 rounded-lg text-white focus:outline-none focus:border-fire-orange w-full md:w-64"})]})]})]}),e.jsxs("div",{className:"bg-fire-secondary/20 border border-white/5 rounded-xl overflow-hidden flex flex-col min-h-[500px]",children:[e.jsx("div",{className:"overflow-x-auto flex-1",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-black/20 text-fire-gray text-xs uppercase tracking-wider border-b border-white/5",children:[e.jsx("th",{className:"p-4 font-medium",children:"Usuário"}),e.jsx("th",{className:"p-4 font-medium",children:"Status"}),e.jsx("th",{className:"p-4 font-medium",children:"Função"}),e.jsx("th",{className:"p-4 font-medium",children:"Data Cadastro"}),e.jsx("th",{className:"p-4 font-medium text-right",children:"Ações"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:N?e.jsx("tr",{children:e.jsxs("td",{colSpan:5,className:"p-8 text-center text-fire-gray",children:[e.jsx(p,{className:"animate-spin inline-block mr-2"})," Carregando..."]})}):C.length>0?C.map(s=>{var t;return e.jsxs("tr",{className:"hover:bg-white/5 transition-colors group",children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-fire-secondary to-fire-dark border border-white/10 flex items-center justify-center text-white font-bold text-sm",children:s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:"",className:"w-full h-full rounded-full object-cover"}):((t=s.full_name)==null?void 0:t.charAt(0))||s.email.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:s.full_name||"Usuário Sem Nome"}),e.jsxs("div",{className:"text-xs text-fire-gray flex items-center gap-1",children:[e.jsx(T,{size:10})," ",s.email]})]})]})}),e.jsx("td",{className:"p-4",children:e.jsxs("span",{className:`
                        inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-bold border
                        ${s.status===o.ACTIVE?"bg-green-500/10 text-green-400 border-green-500/20":s.status===o.PENDING?"bg-yellow-500/10 text-yellow-400 border-yellow-500/20":"bg-red-500/10 text-red-400 border-red-500/20"}
                      `,children:[s.status===o.ACTIVE?e.jsx(I,{size:12}):s.status===o.PENDING?e.jsx(Z,{size:12}):e.jsx(L,{size:12}),s.status===o.ACTIVE?"Ativo":s.status===o.PENDING?"Pendente":"Bloqueado"]})}),e.jsx("td",{className:"p-4",children:e.jsxs("span",{className:`
                        inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium
                        ${s.role===i.ADMIN?"text-purple-300 bg-purple-500/10":"text-blue-300 bg-blue-500/10"}
                      `,children:[s.role===i.ADMIN?e.jsx(ee,{size:12}):e.jsx(B,{size:12}),s.role===i.ADMIN?"Admin":"Membro"]})}),e.jsx("td",{className:"p-4 text-sm text-fire-gray",children:new Date(s.created_at).toLocaleDateString("pt-BR")}),e.jsx("td",{className:"p-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>D(s),className:"p-2 rounded-lg text-fire-gray hover:text-white hover:bg-white/10 transition-colors",title:"Editar Usuário",children:e.jsx(se,{size:18})}),e.jsx("button",{onClick:()=>_(s.id,s.role===i.ADMIN?i.MEMBER:i.ADMIN),disabled:l===s.id,className:"p-2 rounded-lg text-fire-gray hover:text-white hover:bg-white/10 transition-colors",title:s.role===i.ADMIN?"Rebaixar para Membro":"Promover a Admin",children:e.jsx(P,{size:18})}),s.status===o.ACTIVE?e.jsx("button",{onClick:()=>k(s.id,o.BLOCKED),disabled:l===s.id,className:"p-2 rounded-lg text-green-400 hover:text-red-400 hover:bg-red-500/10 transition-colors",title:"Bloquear Acesso",children:l===s.id?e.jsx(p,{size:18,className:"animate-spin"}):e.jsx(L,{size:18})}):e.jsx("button",{onClick:()=>k(s.id,o.ACTIVE),disabled:l===s.id,className:"p-2 rounded-lg text-red-400 hover:text-green-400 hover:bg-green-500/10 transition-colors",title:"Ativar Acesso",children:l===s.id?e.jsx(p,{size:18,className:"animate-spin"}):e.jsx(I,{size:18})}),e.jsx("button",{onClick:()=>$(s.id),disabled:l===s.id,className:"p-2 rounded-lg text-red-500 hover:text-red-400 hover:bg-red-500/10 transition-colors",title:"Excluir Usuário",children:l===s.id?e.jsx(p,{size:18,className:"animate-spin"}):e.jsx(ae,{size:18})})]})})]},s.id)}):e.jsx("tr",{children:e.jsxs("td",{colSpan:5,className:"p-8 text-center text-fire-gray",children:["Nenhum usuário encontrado",h?` com "${h}"`:"","."]})})})]})}),e.jsxs("div",{className:"p-4 border-t border-white/5 flex items-center justify-between bg-black/10",children:[e.jsxs("div",{className:"text-sm text-fire-gray",children:["Mostrando ",e.jsx("span",{className:"text-white font-medium",children:Math.min((d-1)*j+1,g)})," a ",e.jsx("span",{className:"text-white font-medium",children:Math.min(d*j,g)})," de ",e.jsx("span",{className:"text-white font-medium",children:g})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{size:"sm",variant:"secondary",onClick:()=>v(s=>Math.max(1,s-1)),disabled:d===1||N,className:"px-3",children:e.jsx(te,{size:16})}),e.jsxs("span",{className:"text-sm text-fire-gray px-2",children:["Página ",d," de ",y||1]}),e.jsx(b,{size:"sm",variant:"secondary",onClick:()=>v(s=>Math.min(y,s+1)),disabled:d>=y||N,className:"px-3",children:e.jsx(re,{size:16})})]})]})]}),R&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-fire-secondary/20 border border-white/10 p-8 rounded-2xl max-w-lg w-full shadow-2xl relative animate-in fade-in zoom-in duration-300",children:[e.jsx("button",{onClick:()=>w(!1),className:"absolute top-4 right-4 text-fire-gray hover:text-white",children:e.jsx(le,{size:24})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-6 font-montserrat",children:c?"Editar Usuário":"Novo Usuário"}),e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-fire-gray",children:"Nome Completo"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(B,{className:"absolute left-3 top-3.5 text-fire-gray",size:18}),e.jsx("input",{type:"text",required:!0,value:a.name,onChange:s=>m({...a,name:s.target.value}),className:"w-full bg-black/30 border border-white/10 rounded-lg py-3 pl-10 pr-4 text-white focus:outline-none focus:border-fire-orange transition-all",placeholder:"Nome do usuário"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-fire-gray",children:"E-mail"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(T,{className:"absolute left-3 top-3.5 text-fire-gray",size:18}),e.jsx("input",{type:"email",required:!0,value:a.email,onChange:s=>m({...a,email:s.target.value}),className:"w-full bg-black/30 border border-white/10 rounded-lg py-3 pl-10 pr-4 text-white focus:outline-none focus:border-fire-orange transition-all",placeholder:"email@exemplo.com"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-fire-gray",children:"Telefone"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(ie,{className:"absolute left-3 top-3.5 text-fire-gray",size:18}),e.jsx("input",{type:"tel",value:a.phone,onChange:s=>m({...a,phone:s.target.value}),className:"w-full bg-black/30 border border-white/10 rounded-lg py-3 pl-10 pr-4 text-white focus:outline-none focus:border-fire-orange transition-all",placeholder:"(00) 00000-0000"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-fire-gray",children:"Função"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(P,{className:"absolute left-3 top-3.5 text-fire-gray",size:18}),e.jsxs("select",{value:a.role,onChange:s=>m({...a,role:s.target.value}),className:"w-full bg-black/30 border border-white/10 rounded-lg py-3 pl-10 pr-4 text-white focus:outline-none focus:border-fire-orange transition-all appearance-none",children:[e.jsx("option",{value:i.MEMBER,children:"Membro"}),e.jsx("option",{value:i.ADMIN,children:"Admin"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-fire-gray",children:c?"Nova Senha (opcional)":"Senha"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(oe,{className:"absolute left-3 top-3.5 text-fire-gray",size:18}),e.jsx("input",{type:"password",required:!c,value:a.password,onChange:s=>m({...a,password:s.target.value}),className:"w-full bg-black/30 border border-white/10 rounded-lg py-3 pl-10 pr-4 text-white focus:outline-none focus:border-fire-orange transition-all",placeholder:c?"Deixe em branco para manter":"Senha segura",minLength:6})]})]}),e.jsx("div",{className:"pt-2",children:e.jsx(b,{type:"submit",fullWidth:!0,disabled:U,children:U?e.jsx(p,{className:"animate-spin"}):c?"Salvar Alterações":"Criar Usuário"})})]})]})})]})};export{xe as AdminUsers};
