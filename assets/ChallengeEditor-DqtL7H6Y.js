import{j as e,B as p,n as Q,g as Z,s as u}from"./index-C0bb4mgP.js";import{h as K,u as X,r as g}from"./vendor-Cwg8D7Hp.js";import{s as Y,a as j,E as I,w as S,aa as U,Q as v,z as ee,a6 as N,ab as P,ac as A,a9 as _,ad as se,y as q,ae as te,U as ae,V as re,af as ie}from"./ui-C5d7_9yU.js";import"./supabase-DfaSXaSt.js";const de=()=>{const{id:y}=K(),b=X(),[t,n]=g.useState(null),[W,k]=g.useState(!0),[C,z]=g.useState(!1),[h,D]=g.useState(null);g.useEffect(()=>{(async()=>{if(k(!0),y){const a=await Q(parseInt(y));a?n(JSON.parse(JSON.stringify(a))):(alert("Dia nÃ£o encontrado."),b("/admin/challenges"))}else{const a=await Z(),r=a.length>0?Math.max(...a.map(i=>i.day_number))+1:1;n({id:`new-day-${Date.now()}`,day_number:r,title:"Novo Desafio",description:"",morning_message:"",morning_audio_url:"",fire_concept:"",fire_audio_url:"",expected_result:"",reflection_prompt:"",tasks:[],resources:[],reflections:[]})}k(!1)})()},[y]);const c=(s,a)=>{t&&n({...t,[s]:a})},$=(s,a,r)=>{t&&n({...t,tasks:t.tasks.map(i=>i.id===s?{...i,[a]:r}:i)})},M=()=>{if(!t)return;const s={id:`new-task-${Date.now()}`,day_id:t.id,title:"Nova Tarefa",is_completed:!1,order_index:t.tasks.length};n({...t,tasks:[...t.tasks,s]})},L=async s=>{t&&window.confirm("Remover esta tarefa?")&&(s.startsWith("new-")||await u.from("challenge_tasks").delete().eq("id",s),n({...t,tasks:t.tasks.filter(a=>a.id!==s)}))},E=(s,a)=>{if(!t)return;const r=[...t.tasks];a==="up"&&s>0?[r[s],r[s-1]]=[r[s-1],r[s]]:a==="down"&&s<r.length-1&&([r[s],r[s+1]]=[r[s+1],r[s]]);const i=r.map((l,d)=>({...l,order_index:d}));n({...t,tasks:i})},B=(s,a)=>{t&&n({...t,reflections:t.reflections.map(r=>r.id===s?{...r,question:a}:r)})},F=()=>{if(!t)return;const s={id:`new-ref-${Date.now()}`,day_id:t.id,question:"Nova Pergunta de ReflexÃ£o",order_index:t.reflections?t.reflections.length:0};n({...t,reflections:[...t.reflections||[],s]})},V=async s=>{t&&window.confirm("Remover esta pergunta?")&&(s.startsWith("new-")||await u.from("challenge_reflections").delete().eq("id",s),n({...t,reflections:t.reflections.filter(a=>a.id!==s)}))},R=(s,a)=>{if(!t)return;const r=[...t.reflections];a==="up"&&s>0?[r[s],r[s-1]]=[r[s-1],r[s]]:a==="down"&&s<r.length-1&&([r[s],r[s+1]]=[r[s+1],r[s]]);const i=r.map((l,d)=>({...l,order_index:d}));n({...t,reflections:i})},m=(s,a,r)=>{t&&n({...t,resources:t.resources.map(i=>i.id===s?{...i,[a]:r}:i)})},O=()=>{if(!t)return;const s={id:`new-res-${Date.now()}`,day_id:t.id,title:"Novo Material",url:"",type:"link"};n({...t,resources:[...t.resources,s]})},G=async s=>{t&&window.confirm("Remover este material?")&&(s.startsWith("new-")||await u.from("challenge_resources").delete().eq("id",s),n({...t,resources:t.resources.filter(a=>a.id!==s)}))},w=async(s,a,r=!0)=>{if(!s.target.files||s.target.files.length===0||!t)return;const i=s.target.files[0];if(i.size>50*1024*1024){alert("Arquivo muito grande. O limite Ã© 50MB.");return}D(a);try{const l=i.name.replace(/[^a-zA-Z0-9.-]/g,"_"),o=`${`day-${t.day_number.toString().padStart(2,"0")}`}/${Date.now()}-${l}`,{error:f}=await u.storage.from("challenges_assets").upload(o,i,{cacheControl:"3600",upsert:!1});if(f)throw f;const{data:{publicUrl:x}}=u.storage.from("challenges_assets").getPublicUrl(o);r?(m(a,"url",x),i.type.includes("pdf")?m(a,"type","pdf"):i.type.includes("sheet")||i.name.includes("xls")?m(a,"type","sheet"):i.type.includes("audio")?m(a,"type","audio"):i.type.includes("video")?m(a,"type","video"):i.type.includes("image")&&m(a,"type","link")):c(a,x)}catch(l){console.error("Upload failed:",l),alert("Erro no upload: "+l.message)}finally{D(null),s.target.value=""}},J=s=>{switch(s){case"pdf":return e.jsx(S,{size:20,className:"text-red-400"});case"sheet":return e.jsx(ie,{size:20,className:"text-green-400"});case"video":return e.jsx(re,{size:20,className:"text-purple-400"});case"audio":return e.jsx(v,{size:20,className:"text-yellow-400"});case"community":return e.jsx(ae,{size:20,className:"text-blue-400"});case"link":default:return e.jsx(q,{size:20,className:"text-fire-gray"})}},H=async()=>{if(t){z(!0);try{const s=t.id.startsWith("new-"),a={day_number:t.day_number,title:t.title,description:t.description,morning_message:t.morning_message,morning_audio_url:t.morning_audio_url,fire_concept:t.fire_concept,fire_audio_url:t.fire_audio_url,expected_result:t.expected_result,reflection_prompt:t.reflection_prompt,challenge_details:t.challenge_details,commitment_text:t.commitment_text,next_day_teaser:t.next_day_teaser};let r=t.id;if(s){const{data:i,error:l}=await u.from("challenges").insert(a).select().single();if(l)throw l;i&&(r=i.id)}else{const{error:i}=await u.from("challenges").update(a).eq("id",t.id);if(i)throw i}if(t.tasks.length>0){const i=t.tasks.map(d=>{const{id:o,is_completed:f,...x}=d,T={...x,day_id:r};return o.startsWith("new-")?T:{...T,id:o}}),{error:l}=await u.from("challenge_tasks").upsert(i);if(l)throw l}if(t.resources.length>0){const i=t.resources.map(d=>{const{id:o,...f}=d,x={...f,day_id:r};return o.startsWith("new-")?x:{...x,id:o}}),{error:l}=await u.from("challenge_resources").upsert(i);if(l)throw l}if(t.reflections&&t.reflections.length>0){const i=t.reflections.map(d=>{const{id:o,...f}=d,x={...f,day_id:r};return o.startsWith("new-")?x:{...x,id:o}}),{error:l}=await u.from("challenge_reflections").upsert(i);if(l)throw l}alert("Salvo com sucesso!"),b("/admin/challenges")}catch(s){console.error("Save failed:",s),alert("Erro ao salvar: "+s.message)}finally{z(!1)}}};return W?e.jsx("div",{className:"text-white p-8",children:"Carregando editor..."}):t?e.jsxs("div",{className:"space-y-6 pb-20",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 border-b border-white/5 pb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>b("/admin/challenges"),className:"text-fire-gray hover:text-white transition-colors",children:e.jsx(Y,{size:24})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-fire-orange text-xs font-bold uppercase tracking-wider",children:t.id.startsWith("new-")?"Novo ConteÃºdo":"Editar ConteÃºdo"}),e.jsx("h1",{className:"text-2xl font-bold text-white font-montserrat",children:t.id.startsWith("new-")?"Criar Novo Dia":`Dia ${t.day_number}`})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{variant:"secondary",onClick:()=>b("/admin/challenges"),children:"Cancelar"}),e.jsx(p,{onClick:H,disabled:C,className:"min-w-[140px]",children:C?e.jsx(j,{className:"animate-spin"}):e.jsxs("span",{className:"flex items-center",children:[e.jsx(I,{size:18,className:"mr-2"})," Salvar"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"xl:col-span-2 space-y-8",children:[e.jsxs("section",{className:"bg-fire-secondary/20 border border-white/5 rounded-xl p-6 space-y-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(S,{size:20,className:"text-fire-orange"})," Dados do Dia"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-fire-gray mb-1",children:"NÃºmero do Dia"}),e.jsx("input",{type:"number",value:t.day_number,onChange:s=>c("day_number",parseInt(s.target.value)),className:"w-24 bg-black/30 border border-white/10 rounded-lg p-3 text-white focus:border-fire-orange outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-fire-gray mb-1",children:"TÃ­tulo"}),e.jsx("input",{type:"text",value:t.title,onChange:s=>c("title",s.target.value),className:"w-full bg-black/30 border border-white/10 rounded-lg p-3 text-white focus:border-fire-orange outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-fire-gray mb-1",children:"DescriÃ§Ã£o Curta"}),e.jsx("textarea",{value:t.description,onChange:s=>c("description",s.target.value),rows:2,className:"w-full bg-black/30 border border-white/10 rounded-lg p-3 text-white focus:border-fire-orange outline-none resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-fire-gray mb-1",children:"Detalhes do Desafio (Texto Longo)"}),e.jsx("textarea",{value:t.challenge_details||"",onChange:s=>c("challenge_details",s.target.value),rows:4,className:"w-full bg-black/30 border border-white/10 rounded-lg p-3 text-white focus:border-fire-orange outline-none",placeholder:"Ex: #**Seu desafio hoje: Mapeamento completo...**"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"block text-sm font-medium text-fire-gray",children:"Mensagem Matinal"}),e.jsxs("label",{className:"cursor-pointer flex items-center gap-1.5 text-[10px] uppercase font-bold text-fire-orange hover:text-orange-400 transition-colors bg-fire-orange/10 px-2 py-1 rounded",children:[h==="morning_audio_url"?e.jsx(j,{size:12,className:"animate-spin"}):e.jsx(U,{size:12}),h==="morning_audio_url"?"Enviando...":"Upload Ãudio",e.jsx("input",{type:"file",accept:"audio/*",className:"hidden",onChange:s=>w(s,"morning_audio_url",!1)})]})]}),t.morning_audio_url&&e.jsxs("div",{className:"text-xs text-green-400 flex items-center gap-1 mb-1",children:[e.jsx(v,{size:12})," Ãudio vinculado"]}),e.jsx("textarea",{value:t.morning_message||"",onChange:s=>c("morning_message",s.target.value),rows:4,className:"w-full bg-black/30 border border-white/10 rounded-lg p-3 text-white focus:border-fire-orange outline-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"block text-sm font-medium text-fire-gray",children:"Conceito FIRE"}),e.jsxs("label",{className:"cursor-pointer flex items-center gap-1.5 text-[10px] uppercase font-bold text-fire-orange hover:text-orange-400 transition-colors bg-fire-orange/10 px-2 py-1 rounded",children:[h==="fire_audio_url"?e.jsx(j,{size:12,className:"animate-spin"}):e.jsx(U,{size:12}),h==="fire_audio_url"?"Enviando...":"Upload Ãudio",e.jsx("input",{type:"file",accept:"audio/*",className:"hidden",onChange:s=>w(s,"fire_audio_url",!1)})]})]}),t.fire_audio_url&&e.jsxs("div",{className:"text-xs text-green-400 flex items-center gap-1 mb-1",children:[e.jsx(v,{size:12})," Ãudio vinculado"]}),e.jsx("textarea",{value:t.fire_concept||"",onChange:s=>c("fire_concept",s.target.value),rows:3,className:"w-full bg-black/30 border border-white/10 rounded-lg p-3 text-white focus:border-fire-orange outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-fire-gray mb-1",children:"Texto do Compromisso"}),e.jsx("textarea",{value:t.commitment_text||"",onChange:s=>c("commitment_text",s.target.value),rows:3,className:"w-full bg-black/30 border border-white/10 rounded-lg p-3 text-white focus:border-fire-orange outline-none",placeholder:"Ex: ðŸŽ¯ Seu compromisso hoje..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-fire-gray mb-1",children:"AntecipaÃ§Ã£o do PrÃ³ximo Dia"}),e.jsx("textarea",{value:t.next_day_teaser||"",onChange:s=>c("next_day_teaser",s.target.value),rows:3,className:"w-full bg-black/30 border border-white/10 rounded-lg p-3 text-white focus:border-fire-orange outline-none",placeholder:"Ex: âž¡ï¸ AmanhÃ£..."})]})]})]}),e.jsxs("section",{className:"bg-fire-secondary/20 border border-white/5 rounded-xl p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(ee,{size:20,className:"text-fire-orange"})," ReflexÃ£o Guiada"]}),e.jsx(p,{size:"sm",onClick:F,variant:"secondary",children:e.jsx(N,{size:16})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-fire-gray mb-1",children:"Resultado Esperado"}),e.jsx("input",{type:"text",value:t.expected_result||"",onChange:s=>c("expected_result",s.target.value),className:"w-full bg-black/30 border border-white/10 rounded-lg p-3 text-white focus:border-fire-orange outline-none"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-fire-gray",children:"Perguntas de ReflexÃ£o"}),t.reflections&&t.reflections.map((s,a)=>{var r;return e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:s.question,onChange:i=>B(s.id,i.target.value),className:"flex-1 bg-black/30 border border-white/10 rounded-lg p-3 text-white focus:border-fire-orange outline-none",placeholder:"Digite a pergunta..."}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("button",{onClick:()=>R(a,"up"),disabled:a===0,className:"p-1 text-fire-gray hover:text-white disabled:opacity-30",children:e.jsx(P,{size:14})}),e.jsx("button",{onClick:()=>R(a,"down"),disabled:a===(((r=t.reflections)==null?void 0:r.length)||0)-1,className:"p-1 text-fire-gray hover:text-white disabled:opacity-30",children:e.jsx(A,{size:14})})]}),e.jsx("button",{onClick:()=>V(s.id),className:"p-2 text-fire-gray hover:text-red-400",children:e.jsx(_,{size:18})})]},s.id)}),(!t.reflections||t.reflections.length===0)&&e.jsx("div",{className:"text-center text-fire-gray text-xs py-4 border-2 border-dashed border-white/10 rounded-lg",children:"Nenhuma pergunta de reflexÃ£o."})]})]})]})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("section",{className:"bg-fire-secondary/20 border border-white/5 rounded-xl p-6 flex flex-col h-[500px]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[e.jsx(se,{size:20,className:"text-fire-orange"})," Tarefas (",t.tasks.length,")"]}),e.jsx(p,{size:"sm",onClick:M,variant:"secondary",children:e.jsx(N,{size:16})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-3 pr-2 custom-scrollbar",children:[t.tasks.map((s,a)=>e.jsx("div",{className:"bg-white/5 p-3 rounded-lg border border-transparent hover:border-white/10 group transition-colors",children:e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"text",value:s.title,onChange:r=>$(s.id,"title",r.target.value),className:"flex-1 bg-transparent border-b border-white/10 focus:border-fire-orange outline-none text-sm text-white pb-1",placeholder:"TÃ­tulo da tarefa..."}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>E(a,"up"),disabled:a===0,className:"p-1 text-fire-gray hover:text-white disabled:opacity-30",children:e.jsx(P,{size:14})}),e.jsx("button",{onClick:()=>E(a,"down"),disabled:a===t.tasks.length-1,className:"p-1 text-fire-gray hover:text-white disabled:opacity-30",children:e.jsx(A,{size:14})}),e.jsx("button",{onClick:()=>L(s.id),className:"p-1 text-fire-gray hover:text-red-400",children:e.jsx(_,{size:14})})]})]})},s.id)),t.tasks.length===0&&e.jsx("div",{className:"text-center text-fire-gray text-xs py-8 border-2 border-dashed border-white/10 rounded-lg",children:"Nenhuma tarefa."})]})]}),e.jsxs("section",{className:"bg-fire-secondary/20 border border-white/5 rounded-xl p-6 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[e.jsx(q,{size:20,className:"text-fire-orange"})," Materiais"]}),e.jsx(p,{size:"sm",onClick:O,variant:"secondary",children:e.jsx(N,{size:16})})]}),e.jsxs("div",{className:"space-y-4",children:[t.resources.map(s=>e.jsx("div",{className:"bg-white/5 p-4 rounded-lg border border-transparent hover:border-white/10",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center gap-3",children:[e.jsx("div",{className:"shrink-0 bg-black/20 p-2 rounded-lg",children:J(s.type)}),e.jsx("input",{type:"text",value:s.title,onChange:a=>m(s.id,"title",a.target.value),className:"flex-1 bg-transparent border-b border-white/10 focus:border-fire-orange outline-none text-sm text-white font-medium",placeholder:"TÃ­tulo"}),e.jsx("button",{onClick:()=>G(s.id),className:"text-fire-gray hover:text-red-400",children:e.jsx(_,{size:14})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:s.type,onChange:a=>m(s.id,"type",a.target.value),className:"bg-black/30 text-xs text-fire-gray border border-white/10 rounded px-2 py-1 outline-none",children:[e.jsx("option",{value:"pdf",children:"PDF"}),e.jsx("option",{value:"sheet",children:"Planilha"}),e.jsx("option",{value:"video",children:"VÃ­deo"}),e.jsx("option",{value:"audio",children:"Ãudio"}),e.jsx("option",{value:"community",children:"Comunidade"}),e.jsx("option",{value:"link",children:"Link"})]}),e.jsx("input",{type:"text",value:s.url,onChange:a=>m(s.id,"url",a.target.value),placeholder:"https://...",className:"flex-1 bg-black/30 text-xs text-white border border-white/10 rounded px-2 py-1 outline-none"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"cursor-pointer flex items-center gap-1.5 text-[10px] uppercase font-bold text-fire-orange hover:text-orange-400 transition-colors bg-fire-orange/10 px-2 py-1 rounded",children:[h===s.id?e.jsx(j,{size:12,className:"animate-spin"}):e.jsx(te,{size:12}),h===s.id?"Enviando...":"Upload",e.jsx("input",{type:"file",className:"hidden",onChange:a=>w(a,s.id)})]}),e.jsx("span",{className:"text-[10px] text-fire-gray italic max-w-[150px] truncate",children:s.url?"Arquivo vinculado":""})]})]})},s.id)),t.resources.length===0&&e.jsx("div",{className:"text-center text-fire-gray text-xs py-8 border-2 border-dashed border-white/10 rounded-lg",children:"Nenhum material."})]})]})]})]})]}):e.jsx("div",{className:"text-white p-8",children:"Erro ao carregar dia."})};export{de as ChallengeEditor};
