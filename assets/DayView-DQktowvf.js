import{j as e,B as y,g as he,s as N,a as pe,c as ge,d as ue,t as fe,e as be,f as je}from"./index-BzRcWxia.js";import{h as ve,u as ye,r as n}from"./vendor-Cwg8D7Hp.js";import{d as Q,s as Ne,L as we,t as J,u as K,i as L,l as X,v as Y,W as ke,w as _e,D as Z,x as ze,y as Ce,z as Se,a as De,m as P,E as Ee,H as ee,G as Re,I as Te}from"./ui-C5d7_9yU.js";import"./supabase-DfaSXaSt.js";const $e=({url:x,title:p})=>{const s=i=>{var g;try{if(i.includes("youtube.com")||i.includes("youtu.be")){let l="";return i.includes("youtu.be")?l=i.split("/").pop()||"":l=((g=i.split("v=")[1])==null?void 0:g.split("&")[0])||"",`https://www.youtube.com/embed/${l}?rel=0&modestbranding=1`}if(i.includes("vimeo.com"))return`https://player.vimeo.com/video/${i.split(".com/")[1]}?title=0&byline=0&portrait=0`}catch(l){console.error("Error parsing video URL",l)}return i};return x.includes("youtube")||x.includes("youtu.be")||x.includes("vimeo")?e.jsxs("div",{className:"w-full",children:[p&&e.jsx("h3",{className:"text-white font-bold mb-2 text-sm uppercase tracking-wider",children:p}),e.jsx("div",{className:"relative pt-[56.25%] bg-black rounded-xl overflow-hidden shadow-2xl border border-white/10 group",children:e.jsx("iframe",{src:s(x),className:"absolute top-0 left-0 w-full h-full",title:p||"Video Player",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})})]}):null},Ie=()=>{const{id:x}=ve(),p=ye(),[s,A]=n.useState(null),[i,g]=n.useState(null),[l,te]=n.useState(null),[u,w]=n.useState([]),[se,U]=n.useState(!0),[m,k]=n.useState(!1),[f,re]=n.useState(!1),[b,ae]=n.useState(!1),[I,B]=n.useState(""),[O,F]=n.useState(!1),[_,M]=n.useState(!1),[z,V]=n.useState({}),[H,q]=n.useState({}),[ie,C]=n.useState(!1);n.useEffect(()=>{(async()=>{U(!0),window.scrollTo(0,0);const a=await he(),r=Number(x),o=a.find(d=>d.day_number===r),c=a.find(d=>d.day_number===r-1),D=a.find(d=>d.day_number===r+1);if(g(c||null),te(D||null),o){A(o);const{data:{user:d}}=await N.auth.getUser(),E=(d==null?void 0:d.id)||"mock-user-id",[R,xe,me]=await Promise.all([pe(E),ge(E,o.id),o.reflections&&o.reflections.length>0?ue(E,o.reflections.map(v=>v.id)):Promise.resolve({})]);if(w(R),B(xe),V(me),R.some(v=>o.tasks.some(T=>T.id===v))&&C(!0),c){const T=c.tasks.map($=>$.id).every($=>R.includes($));c.tasks.length>0&&!T?k(!0):k(!1)}else k(!1)}U(!1)})()},[x]);const ne=async t=>{if(m)return;const a=u.includes(t),{data:{user:r}}=await N.auth.getUser(),o=(r==null?void 0:r.id)||"mock-user-id";a?w(c=>c.filter(D=>D!==t)):(w(c=>[...c,t]),C(!0)),await fe(o,t,!a)},le=async()=>{if(!s||m)return;F(!0);const{data:{user:t}}=await N.auth.getUser(),a=(t==null?void 0:t.id)||"mock-user-id";await je(a,s.id,I),F(!1),M(!0),setTimeout(()=>M(!1),2e3)},oe=(t,a)=>{V(r=>({...r,[t]:a}))},de=async t=>{const{data:{user:a}}=await N.auth.getUser();if(a){q(r=>({...r,[t]:!0}));try{await be(a.id,t,z[t])}catch(r){console.error("Error saving reflection",r)}finally{setTimeout(()=>{q(r=>({...r,[t]:!1}))},500)}}},ce=()=>{if(!s||s.tasks.length===0)return 0;const t=s.tasks.filter(a=>u.includes(a.id)).length;return Math.round(t/s.tasks.length*100)},j=t=>{p(`/day/${t}`)};if(se)return e.jsx("div",{className:"min-h-screen flex items-center justify-center text-white",children:e.jsxs("div",{className:"animate-pulse flex flex-col items-center gap-4",children:[e.jsx(Q,{className:"text-fire-orange animate-bounce",size:40}),e.jsx("span",{children:"Carregando seu desafio..."})]})});if(!s)return e.jsx("div",{className:"p-8 text-white",children:"Dia não encontrado."});const S=ce(),h=S===100,W=s.resources.filter(t=>t.type==="video"),G=s.resources.filter(t=>t.type!=="video");return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8 md:space-y-12 pb-32",children:[e.jsxs("div",{className:"sticky top-0 z-30 bg-fire-dark/95 backdrop-blur-md py-4 border-b border-white/5 -mx-6 px-6 md:mx-0 md:px-0 md:static md:bg-transparent md:border-none",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("button",{onClick:()=>p("/"),className:"group flex items-center text-fire-gray hover:text-white transition-colors text-sm font-medium",children:[e.jsx("div",{className:"bg-white/5 p-1.5 rounded-lg mr-2 group-hover:bg-white/10 transition-colors",children:e.jsx(Ne,{size:14})}),"Voltar"]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsxs("span",{className:"text-xs font-bold text-fire-orange tracking-widest uppercase",children:["DIA ",s.day_number.toString().padStart(2,"0")]}),e.jsx("span",{className:`text-xs font-bold px-2 py-0.5 rounded ${m?"bg-red-500/10 text-red-400":"bg-green-500/10 text-green-400"}`,children:m?"BLOQUEADO":"LIBERADO"})]})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 h-2 bg-fire-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-700 ease-out ${h?"bg-green-500":"bg-fire-orange"}`,style:{width:`${S}%`}})}),e.jsxs("span",{className:"text-xs font-bold text-white min-w-[3rem] text-right",children:[S,"%"]})]})]}),e.jsxs("header",{className:"text-center space-y-4 pt-4 md:pt-0",children:[e.jsx("h1",{className:"text-3xl md:text-5xl font-bold text-white font-montserrat tracking-tight leading-tight",children:s.title.includes(":")?s.title.split(": ")[1]:s.title}),e.jsx("p",{className:"text-fire-gray text-lg max-w-2xl mx-auto leading-relaxed",children:s.description})]}),m?e.jsxs("div",{className:"bg-fire-secondary/20 border border-red-500/20 rounded-2xl p-8 text-center py-20 space-y-6 animate-in fade-in slide-in-from-bottom-4",children:[e.jsx("div",{className:"w-20 h-20 bg-red-500/10 rounded-full flex items-center justify-center mx-auto border-2 border-red-500/20",children:e.jsx(we,{size:40,className:"text-red-400"})}),e.jsxs("div",{className:"max-w-md mx-auto space-y-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-white font-montserrat",children:"Conteúdo Bloqueado"}),e.jsxs("p",{className:"text-fire-gray",children:["Para acessar o conteúdo do ",e.jsxs("strong",{children:["Dia ",s.day_number]}),", você precisa completar todas as tarefas do dia anterior."]}),i&&e.jsxs(y,{onClick:()=>j(i.day_number),variant:"outline",className:"mt-4",children:["Voltar para o Dia ",i.day_number]})]})]}):e.jsxs("div",{className:"space-y-12 animate-in fade-in duration-500",children:[e.jsxs("section",{className:"bg-gradient-to-br from-fire-secondary/30 to-fire-dark border border-white/5 rounded-2xl p-6 md:p-8 relative overflow-hidden group hover:border-fire-orange/20 transition-all",children:[e.jsx("div",{className:"absolute top-0 right-0 p-8 opacity-10 group-hover:opacity-20 transition-opacity pointer-events-none",children:e.jsx(J,{size:100,className:"text-yellow-500"})}),e.jsxs("h2",{className:"text-xl font-bold text-white mb-6 font-montserrat flex items-center gap-3",children:[e.jsx("span",{className:"bg-yellow-500/20 text-yellow-400 p-2 rounded-lg",children:e.jsx(J,{size:20})}),"Mensagem Matinal"]}),e.jsx("div",{className:"space-y-4",children:s.morning_audio_url?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-black/40 p-4 rounded-xl border border-white/10 shadow-inner",children:e.jsx("audio",{controls:!0,className:"w-full h-12 accent-fire-orange",src:s.morning_audio_url})}),e.jsxs("button",{onClick:()=>re(!f),className:"flex items-center gap-2 text-sm text-fire-gray hover:text-white transition-colors font-medium",children:[f?e.jsx(K,{size:16}):e.jsx(L,{size:16}),f?"Ocultar texto":"Ler mensagem completa"]}),f&&e.jsxs("div",{className:"prose prose-invert prose-lg text-fire-light/90 leading-relaxed font-light italic border-l-4 border-yellow-500/30 pl-6 animate-in fade-in slide-in-from-top-2",children:['"',s.morning_message,'"']})]}):e.jsxs("div",{className:"prose prose-invert prose-lg text-fire-light/90 leading-relaxed font-light italic border-l-4 border-yellow-500/30 pl-6",children:['"',s.morning_message,'"']})})]}),e.jsxs("section",{className:"bg-[#011627] border border-fire-secondary rounded-2xl p-6 md:p-8 relative overflow-hidden shadow-lg",children:[e.jsx("div",{className:"absolute -right-10 -top-10 w-40 h-40 bg-fire-orange/10 rounded-full blur-3xl pointer-events-none"}),e.jsxs("h2",{className:"text-xl font-bold text-white mb-6 font-montserrat flex items-center gap-3 relative z-10",children:[e.jsx("span",{className:"bg-fire-orange/20 text-fire-orange p-2 rounded-lg",children:e.jsx(Q,{size:20})}),"Conceito FIRE do Dia"]}),e.jsx("div",{className:"bg-fire-secondary/20 p-6 rounded-xl border border-white/5 relative z-10 space-y-4",children:s.fire_audio_url?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-black/40 p-4 rounded-xl border border-white/10 shadow-inner",children:e.jsx("audio",{controls:!0,className:"w-full h-12 accent-fire-orange",src:s.fire_audio_url})}),e.jsxs("button",{onClick:()=>ae(!b),className:"flex items-center gap-2 text-sm text-fire-gray hover:text-white transition-colors font-medium",children:[b?e.jsx(K,{size:16}):e.jsx(L,{size:16}),b?"Ocultar texto":"Ler conceito completo"]}),b&&e.jsx("p",{className:"text-lg font-medium text-white text-center md:text-left leading-relaxed animate-in fade-in slide-in-from-top-2",children:s.fire_concept})]}):e.jsx("p",{className:"text-lg font-medium text-white text-center md:text-left leading-relaxed",children:s.fire_concept})})]}),e.jsxs("section",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white font-montserrat flex items-center gap-3",children:[e.jsx(X,{className:"text-fire-orange",size:28}),"Seu Desafio Hoje"]}),W.length>0&&e.jsx("div",{className:"grid gap-6",children:W.map(t=>e.jsx($e,{url:t.url,title:t.title},t.id))}),e.jsxs("div",{className:"bg-fire-secondary/10 border border-white/10 rounded-xl p-6 text-fire-light leading-relaxed",children:[e.jsxs("p",{className:"mb-4",children:["Hoje vamos focar em: ",e.jsx("span",{className:"text-white font-bold",children:s.description}),"."]}),s.challenge_details&&e.jsx("div",{className:"whitespace-pre-wrap text-white/90 font-medium border-t border-white/10 pt-4 mt-4",children:s.challenge_details})]})]}),e.jsxs("section",{className:"bg-fire-secondary/20 border border-white/5 rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"bg-fire-secondary/40 p-6 border-b border-white/5 flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-bold text-white font-montserrat flex items-center gap-3",children:[e.jsx(Y,{className:"text-green-400",size:24}),"Passo a Passo"]}),e.jsx("span",{className:`text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider ${h?"bg-green-500 text-white":"bg-black/20 text-fire-gray"}`,children:h?"Completo!":`${s.tasks.filter(t=>u.includes(t.id)).length}/${s.tasks.length}`})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[s.tasks.map((t,a)=>{const r=u.includes(t.id);return e.jsxs("div",{onClick:()=>ne(t.id),className:`
                      relative group flex items-start gap-4 p-4 rounded-xl cursor-pointer transition-all border
                      ${r?"bg-green-500/5 border-green-500/20 shadow-[0_0_15px_-5px_rgba(34,197,94,0.3)]":"bg-white/5 border-transparent hover:bg-white/10 hover:border-white/20 hover:shadow-lg"}
                    `,children:[e.jsx("div",{className:"mt-1 relative",children:e.jsx("div",{className:`
                        w-6 h-6 rounded-md border-2 flex items-center justify-center transition-all duration-300
                        ${r?"bg-green-500 border-green-500":"border-fire-gray group-hover:border-fire-orange"}
                      `,children:r&&e.jsx(Y,{size:16,className:"text-white"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-semibold mb-1 transition-colors ${r?"text-fire-gray line-through":"text-white group-hover:text-fire-orange"}`,children:t.title}),t.description&&e.jsx("p",{className:"text-sm text-fire-gray",children:t.description})]}),e.jsx("div",{className:"absolute right-4 top-4 text-fire-gray/20 font-bold text-4xl select-none group-hover:text-fire-gray/40 transition-colors",children:a+1})]},t.id)}),s.tasks.length===0&&e.jsx("p",{className:"text-fire-gray text-center text-sm py-4",children:"Nenhuma tarefa cadastrada para este dia."})]})]}),G.length>0&&e.jsxs("section",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-white font-montserrat flex items-center gap-3 px-2",children:[e.jsx(ke,{className:"text-blue-400",size:24}),"Ferramentas"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:G.map(t=>{const a=t.type==="pdf"?_e:t.type==="sheet"?Z:t.type==="community"?ze:Ce,r=t.type==="sheet"?"text-green-400 bg-green-400/10":t.type==="pdf"?"text-red-400 bg-red-400/10":t.type==="community"?"text-blue-400 bg-blue-400/10":"text-fire-gray bg-white/10";return e.jsxs("a",{href:t.url,target:"_blank",rel:"noreferrer",className:"flex items-center gap-4 bg-fire-secondary/20 border border-white/5 p-4 rounded-xl hover:bg-fire-secondary/40 hover:border-fire-orange/30 transition-all group",children:[e.jsx("div",{className:`p-3 rounded-lg ${r} group-hover:scale-110 transition-transform`,children:e.jsx(a,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-white text-sm group-hover:text-fire-orange transition-colors",children:t.title}),e.jsx("span",{className:"text-xs text-fire-gray uppercase tracking-wider",children:t.type})]}),e.jsx("div",{className:"ml-auto opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Z,{size:16,className:"text-fire-gray"})})]},t.id)})})]}),e.jsxs("section",{className:"bg-blue-900/10 border border-blue-500/20 rounded-xl p-6 flex items-start gap-4",children:[e.jsx("div",{className:"bg-blue-500/20 p-3 rounded-full shrink-0",children:e.jsx(X,{size:24,className:"text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-blue-200 font-bold mb-1 uppercase text-xs tracking-wider",children:"Resultado Esperado"}),e.jsxs("p",{className:"text-white font-medium italic",children:['"',s.expected_result,'"']})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-white font-montserrat flex items-center gap-3 px-2",children:[e.jsx(Se,{className:"text-purple-400",size:24}),"Reflexão Guiada"]}),e.jsx("div",{className:"bg-gradient-to-br from-fire-secondary/20 to-fire-dark border border-white/10 rounded-2xl p-6 md:p-8 space-y-8",children:s.reflections&&s.reflections.length>0?s.reflections.map(t=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-lg text-white font-medium leading-relaxed flex items-start gap-2",children:[e.jsx("span",{className:"text-fire-orange mt-1",children:"•"}),t.question]}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:z[t.id]||"",onChange:a=>oe(t.id,a.target.value),onBlur:()=>de(t.id),className:"w-full bg-black/30 border border-white/10 rounded-xl p-4 text-fire-light placeholder-white/20 focus:outline-none focus:border-fire-orange/50 focus:ring-1 focus:ring-fire-orange/50 transition-all h-32 resize-none leading-relaxed",placeholder:"Sua resposta..."}),e.jsxs("div",{className:"absolute bottom-4 right-4 flex items-center gap-2",children:[H[t.id]&&e.jsxs("span",{className:"text-xs text-fire-gray flex items-center gap-1",children:[e.jsx(De,{size:12,className:"animate-spin"})," Salvando..."]}),!H[t.id]&&z[t.id]&&e.jsxs("span",{className:"text-xs text-green-400 flex items-center gap-1",children:[e.jsx(P,{size:12})," Salvo"]})]})]})]},t.id)):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-lg text-white font-medium max-w-2xl",children:s.reflection_prompt}),e.jsx("textarea",{value:I,onChange:t=>B(t.target.value),className:"w-full bg-black/30 border border-white/10 rounded-xl p-6 text-fire-light placeholder-white/20 focus:outline-none focus:border-fire-orange/50 focus:ring-1 focus:ring-fire-orange/50 transition-all h-48 resize-none leading-relaxed",placeholder:"Este é o seu diário de bordo. Escreva seus insights, dificuldades e vitórias de hoje..."}),e.jsxs("button",{onClick:le,disabled:O,className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-bold transition-all whitespace-nowrap ml-auto
                                ${_?"bg-green-500/20 text-green-400":"bg-white/5 text-fire-gray hover:bg-fire-orange/10 hover:text-fire-orange"}
                                `,children:[_?e.jsx(P,{size:16}):e.jsx(Ee,{size:16}),_?"Salvo":O?"Salvando...":"Salvar Anotação"]})]})})]}),e.jsxs("section",{className:"flex flex-col items-center justify-center py-8 border-t border-white/5 space-y-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-fire-gray font-montserrat flex items-center gap-2 opacity-70",children:[e.jsx(ee,{size:20}),"Compromisso do Dia"]}),s.commitment_text&&e.jsxs("div",{className:"max-w-4xl w-full bg-gradient-to-br from-fire-secondary/20 to-fire-secondary/5 border border-white/5 rounded-2xl p-8 md:p-10 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1.5 h-full bg-fire-orange group-hover:w-2 transition-all duration-300"}),e.jsx("div",{className:"absolute -right-6 -bottom-6 text-white/5 transform rotate-12",children:e.jsx(ee,{size:120})}),e.jsxs("p",{className:"text-lg md:text-xl text-white/90 leading-relaxed italic whitespace-pre-line text-center md:text-left relative z-10 font-medium",children:['"',s.commitment_text,'"']})]}),e.jsx("div",{className:"text-center w-full max-w-md",children:ie?e.jsxs("div",{className:"flex flex-col items-center gap-2 animate-in fade-in zoom-in duration-500 bg-green-500/10 p-6 rounded-2xl border border-green-500/20",children:[e.jsx("div",{className:"w-12 h-12 bg-green-500/20 rounded-full flex items-center justify-center text-green-500 mb-2",children:e.jsx(P,{size:24})}),e.jsx("p",{className:"text-green-400 font-bold text-lg",children:"Compromisso Firmado!"}),e.jsx("p",{className:"text-fire-gray text-sm",children:"Continue completando as tarefas acima."})]}):e.jsx(y,{size:"lg",fullWidth:!0,onClick:()=>C(!0),className:"animate-pulse shadow-[0_0_20px_rgba(255,102,0,0.4)]",children:"Eu me comprometo a executar!"})})]}),s.next_day_teaser&&e.jsxs("section",{className:"bg-black/40 border border-white/10 rounded-xl p-6 md:p-8",children:[e.jsxs("h3",{className:"text-lg font-bold text-fire-orange mb-3 flex items-center gap-2",children:[e.jsx(Re,{size:20}),"Amanhã"]}),e.jsx("p",{className:"text-white/80 leading-relaxed whitespace-pre-wrap",children:s.next_day_teaser})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-fire-dark/95 backdrop-blur-lg border-t border-white/10 z-20 md:static md:bg-transparent md:border-none md:p-0 md:pt-12",children:e.jsxs("div",{className:"max-w-4xl mx-auto flex items-center justify-between gap-4",children:[e.jsxs(y,{variant:"secondary",disabled:!i,onClick:()=>i&&j(i.day_number),className:"flex-1 md:flex-none flex items-center justify-center gap-2",children:[e.jsx(Te,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Dia Anterior"}),e.jsx("span",{className:"md:hidden",children:"Anterior"})]}),e.jsxs(y,{variant:h?"primary":"outline",disabled:!l||!h&&!m,onClick:()=>{(l&&h||m&&l)&&j(l.day_number)},className:`flex-1 md:flex-none flex items-center justify-center gap-2 min-w-[140px] ${h?"":"opacity-50 cursor-not-allowed"}`,children:[e.jsx("span",{className:"hidden md:inline",children:"Próximo Dia"}),e.jsx("span",{className:"md:hidden",children:"Próximo"}),e.jsx(L,{size:18})]})]})})]})};export{Ie as DayView};
