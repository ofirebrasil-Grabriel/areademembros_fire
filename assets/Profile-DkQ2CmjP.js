import{j as e,B as U,h as T,s as c,u as M}from"./index-CiRdGeTh.js";import{r}from"./vendor-gtDS_TVX.js";import{a as f,J as F,g as _,G,K as J,P as K,E as O,m as W,S as D}from"./ui-R5Y-RMdR.js";import"./supabase-CBvtPKqy.js";const Z=()=>{const[a,m]=r.useState(null),[l,h]=r.useState(""),[u,p]=r.useState(""),[$,B]=r.useState(!0),[g,b]=r.useState(!1),[L,n]=r.useState(!1),[j,v]=r.useState(!1),[w,y]=r.useState(""),[d,N]=r.useState(""),[S,P]=r.useState(""),[C,k]=r.useState(!1),[x,i]=r.useState(null);r.useEffect(()=>{(async()=>{const t=await T();t&&(m(t),m(t),h(t.full_name||""),p(t.phone||"")),B(!1)})()},[]);const R=async s=>{s.preventDefault(),b(!0),await M(l,a==null?void 0:a.avatar_url,u),b(!1),n(!0),setTimeout(()=>n(!1),3e3)},q=async s=>{if(!s.target.files||s.target.files.length===0||!a)return;const t=s.target.files[0];if(t.size>5*1024*1024){alert("A imagem deve ter no máximo 5MB.");return}v(!0);try{const o=t.name.split(".").pop(),E=`avatars/${`${a.id}-${Date.now()}.${o}`}`,{error:z}=await c.storage.from("challenges_assets").upload(E,t);if(z)throw z;const{data:{publicUrl:A}}=c.storage.from("challenges_assets").getPublicUrl(E);m({...a,avatar_url:A}),await M(l,A,u),n(!0),setTimeout(()=>n(!1),3e3)}catch(o){console.error("Error uploading avatar:",o),alert("Erro ao fazer upload da imagem.")}finally{v(!1)}},I=async s=>{if(s.preventDefault(),i(null),d!==S){i({type:"error",text:"As novas senhas não coincidem."});return}if(d.length<6){i({type:"error",text:"A nova senha deve ter pelo menos 6 caracteres."});return}k(!0);try{const{error:t}=await c.auth.signInWithPassword({email:(a==null?void 0:a.email)||"",password:w});if(t)throw new Error("Senha atual incorreta.");const{error:o}=await c.auth.updateUser({password:d});if(o)throw o;i({type:"success",text:"Senha alterada com sucesso!"}),y(""),N(""),P("")}catch(t){i({type:"error",text:t.message||"Erro ao alterar senha."})}finally{k(!1)}};return $?e.jsx("div",{className:"p-8 text-center text-fire-gray",children:"Carregando perfil..."}):a?e.jsxs("div",{className:"max-w-2xl mx-auto space-y-8 animate-in fade-in duration-500",children:[e.jsx("h1",{className:"text-3xl font-bold text-white font-montserrat",children:"Minha Conta"}),e.jsxs("div",{className:"bg-fire-secondary/20 border border-white/5 rounded-2xl p-8 shadow-xl",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-8 mb-8",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"w-32 h-32 rounded-full bg-gradient-to-br from-fire-orange to-fire-dark border-4 border-fire-secondary flex items-center justify-center shadow-lg shadow-fire-orange/20 overflow-hidden",children:a.avatar_url?e.jsx("img",{src:a.avatar_url,alt:"Profile",className:"w-full h-full rounded-full object-cover"}):e.jsx("span",{className:"text-4xl font-bold text-white font-montserrat",children:l?l.charAt(0).toUpperCase():a.email.charAt(0).toUpperCase()})}),e.jsxs("label",{className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer",children:[j?e.jsx(f,{className:"animate-spin text-white"}):e.jsx(F,{className:"text-white"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:q,disabled:j})]})]}),e.jsxs("div",{className:"text-center md:text-left space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-center md:justify-start gap-2",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:l||"Membro FIRE"}),e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold uppercase border ${a.role==="admin"?"bg-purple-500/10 text-purple-400 border-purple-500/20":"bg-green-500/10 text-green-400 border-green-500/20"}`,children:a.role==="admin"?"Admin":"Membro"})]}),e.jsxs("p",{className:"text-fire-gray flex items-center justify-center md:justify-start gap-2",children:[e.jsx(_,{size:14})," ",a.email]}),e.jsxs("p",{className:"text-fire-gray/60 text-sm flex items-center justify-center md:justify-start gap-2",children:[e.jsx(G,{size:14})," Membro desde ",new Date(a.created_at).toLocaleDateString("pt-BR")]})]})]}),e.jsxs("form",{onSubmit:R,className:"space-y-6 max-w-lg mx-auto md:mx-0",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-fire-gray mb-2",children:"Nome Completo"}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-3.5 text-fire-gray",size:18}),e.jsx("input",{type:"text",value:l,onChange:s=>h(s.target.value),className:"w-full bg-black/30 border border-white/10 rounded-lg py-3 pl-10 pr-4 text-white placeholder-fire-secondary/50 focus:outline-none focus:border-fire-orange focus:ring-1 focus:ring-fire-orange transition-all",placeholder:"Como você gostaria de ser chamado?"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-fire-gray mb-2",children:"Telefone"}),e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-3.5 text-fire-gray",size:18}),e.jsx("input",{type:"tel",value:u,onChange:s=>p(s.target.value),className:"w-full bg-black/30 border border-white/10 rounded-lg py-3 pl-10 pr-4 text-white placeholder-fire-secondary/50 focus:outline-none focus:border-fire-orange focus:ring-1 focus:ring-fire-orange transition-all",placeholder:"(00) 00000-0000"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-fire-gray mb-2",children:"E-mail (Não editável)"}),e.jsxs("div",{className:"relative opacity-60",children:[e.jsx(_,{className:"absolute left-3 top-3.5 text-fire-gray",size:18}),e.jsx("input",{type:"text",value:a.email,disabled:!0,className:"w-full bg-black/30 border border-white/10 rounded-lg py-3 pl-10 pr-4 text-fire-gray cursor-not-allowed"})]})]}),e.jsxs("div",{className:"pt-4 flex items-center gap-4",children:[e.jsx(U,{type:"submit",disabled:g,children:g?e.jsx(f,{className:"animate-spin"}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{size:18})," Salvar Alterações"]})}),L&&e.jsxs("span",{className:"flex items-center gap-2 text-green-400 text-sm animate-in fade-in",children:[e.jsx(W,{size:16})," Dados atualizados!"]})]})]})]}),e.jsxs("div",{className:"bg-fire-secondary/20 border border-white/5 rounded-2xl p-8 shadow-xl",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-6 flex items-center gap-2",children:[e.jsx(D,{className:"text-fire-orange"})," Alterar Senha"]}),e.jsxs("form",{onSubmit:I,className:"space-y-6 max-w-lg mx-auto md:mx-0",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-fire-gray mb-2",children:"Senha Atual"}),e.jsx("input",{type:"password",value:w,onChange:s=>y(s.target.value),className:"w-full bg-black/30 border border-white/10 rounded-lg py-3 px-4 text-white focus:outline-none focus:border-fire-orange transition-all",placeholder:"Digite sua senha atual",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-fire-gray mb-2",children:"Nova Senha"}),e.jsx("input",{type:"password",value:d,onChange:s=>N(s.target.value),className:"w-full bg-black/30 border border-white/10 rounded-lg py-3 px-4 text-white focus:outline-none focus:border-fire-orange transition-all",placeholder:"Mínimo 6 caracteres",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-fire-gray mb-2",children:"Confirmar Nova Senha"}),e.jsx("input",{type:"password",value:S,onChange:s=>P(s.target.value),className:"w-full bg-black/30 border border-white/10 rounded-lg py-3 px-4 text-white focus:outline-none focus:border-fire-orange transition-all",placeholder:"Repita a nova senha",required:!0})]})]}),e.jsx("div",{className:"pt-2",children:e.jsx(U,{type:"submit",disabled:C,variant:"secondary",className:"w-full md:w-auto",children:C?e.jsx(f,{className:"animate-spin"}):"Atualizar Senha"})}),x&&e.jsx("div",{className:`p-3 rounded-lg text-sm ${x.type==="success"?"bg-green-500/10 text-green-400":"bg-red-500/10 text-red-400"}`,children:x.text})]})]}),e.jsxs("div",{className:"bg-fire-secondary/10 border border-white/5 rounded-2xl p-6 flex items-start gap-4",children:[e.jsx(D,{className:"text-blue-400 shrink-0 mt-1",size:24}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-1",children:"Segurança e Privacidade"}),e.jsx("p",{className:"text-fire-gray text-sm leading-relaxed",children:"Seus dados estão seguros. Se precisar alterar sua senha ou solicitar a exclusão da conta, entre em contato com o suporte através do e-mail de boas-vindas."})]})]})]}):e.jsx("div",{className:"p-8 text-center text-fire-gray",children:"Erro ao carregar perfil."})};export{Z as Profile};
